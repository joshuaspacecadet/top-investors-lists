<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Top 3 Aerospace Seed Investors</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
      :root { --accent: #ff6a00; }
      body { font-family: Inter, system-ui, Arial; padding: 32px; max-width: 1040px; margin: 0 auto; background: #000; color: #fff; }
      button { padding: 10px 14px; border: 1px solid #2a2a2a; background: #0d0d0d; color: #fff; border-radius: 6px; cursor: pointer; }
      .note { color: #fff; }
      h1 { font-family: "Chakra Petch", Inter, system-ui, Arial; font-size: 44px; margin: 0 0 20px 0; letter-spacing: 0.5px; }
      .records { display: flex; flex-direction: column; gap: 20px; margin: 20px 0 24px 0; }
      .record { display: grid; grid-template-columns: 1fr 320px; gap: 28px; border: 1px solid #1a1a1a; background: #070707; padding: 24px; border-radius: 12px; }
      .record-info { display: flex; flex-direction: column; gap: 10px; }
      .record-index { font-family: "Chakra Petch", Inter, system-ui, Arial; font-size: 40px; color: var(--accent); line-height: 1; }
      .record-name { font-family: "Chakra Petch", Inter, system-ui, Arial; font-size: 40px; line-height: 1.1; letter-spacing: 0.5px; text-transform: uppercase; }
      .record-fund { font-size: 22px; letter-spacing: 2px; text-transform: uppercase; color: #e6e6e6; margin-top: 6px; }
      .record-fund a { color: inherit; text-decoration: none; border-bottom: 1px solid #333; }
      .kv { margin-top: 14px; }
      .kv-label { font-weight: 600; margin: 0 0 4px 0; }
      .kv-value { margin: 0; color: #ddd; }
      .record-image { display: flex; justify-content: flex-end; }
      .record-image img { width: 320px; height: 320px; object-fit: cover; border-radius: 8px; background: #111; border: 1px solid #1f1f1f; }
      .hero { position: relative; margin: 0 0 24px 0; border-radius: 12px; overflow: hidden; border: 1px solid #141414; }
      .hero img { width: 100%; height: 240px; object-fit: cover; filter: brightness(0.6) contrast(1.05); display: block; }
      .hero-overlay { position: absolute; inset: 0; display: flex; align-items: center; padding: 20px 24px; }
      .hero-copy { max-width: 72ch; font-size: 18px; line-height: 1.5; color: #f3f3f3; }
    </style>
  </head>
  <body
    data-base="appNWh4J1hBABWC6J"
    data-table="tblOqtOhWAfA9fWaR"
    data-view="viwsSmHXp0rEeut2R">

    <div class="hero">
      <img src="https://aerospace.org/sites/default/files/styles/hero_small/public/2019-05/stp3.jpg?itok=LotgvROx" alt="Aerospace launch hero" />
      <div class="hero-overlay">
        <p class="hero-copy">Identifying appropriate investors is hard. Here's a curated list of Seed investors (in alphabetical order) who actually lead rounds.</p>
      </div>
    </div>

    <h1>Top 3 Aerospace Seed Investors</h1>
    <div id="records" class="records"></div>
    <p class="note">Click the button to create a Google Sheet in <em>your</em> Drive from the live Airtable view.</p>
    <button id="copyBtn">Copy to Google Sheets</button>

    <script>
      // PUT YOUR CLIENT ID HERE (from Google Cloud Console)
      const GOOGLE_CLIENT_ID = "964428463207-81190lnabk68t0cbcgb5sbab5bss6tp1.apps.googleusercontent.com";

      // OAuth scopes needed to create + write a Sheet in the user's Drive
      const SCOPES = "https://www.googleapis.com/auth/spreadsheets";

      function getAccessToken() {
        return new Promise((resolve, reject) => {
          const client = google.accounts.oauth2.initTokenClient({
            client_id: GOOGLE_CLIENT_ID,
            scope: SCOPES,
            callback: resp => {
              if (resp && resp.access_token) resolve(resp.access_token);
              else reject(new Error("No access token"));
            }
          });
          client.requestAccessToken();
        });
      }

      async function createSheet() {
        const accessToken = await getAccessToken();

        const el = document.body.dataset;
        const payload = {
          base:  el.base,
          table: el.table,
          view:  el.view,
          namePrefix: "Top Investors Lists — Aerospace"
        };

        const res = await fetch("/.netlify/functions/new-sheet", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${accessToken}`
          },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.error || "Failed to create Sheet");
        window.open(data.url, "_blank");
      }

      document.getElementById("copyBtn").addEventListener("click", async () => {
        const btn = document.getElementById("copyBtn");
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.textContent = "Creating Sheet…";
        try {
          // run OAuth + fetch as before
          const accessToken = await getAccessToken();
          const el = document.body.dataset;
          const payload = {
            base:  el.base,
            table: el.table,
            view:  el.view,
            namePrefix: "Top Investors Lists — Aerospace"
          };
          const res = await fetch("/.netlify/functions/new-sheet", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${accessToken}`
            },
            body: JSON.stringify(payload)
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || "Failed to create Sheet");
          // navigate current tab to the new Sheet
          window.location.href = data.url;
        } catch (e) {
          alert("Copy failed: " + (e.message || e));
          btn.disabled = false;
          btn.textContent = originalText;
        }
      });

      async function loadRecords() {
        const container = document.getElementById("records");
        const { base, table, view } = document.body.dataset;
        try {
          const url = `/.netlify/functions/list-records?base=${encodeURIComponent(base)}&table=${encodeURIComponent(table)}&view=${encodeURIComponent(view)}`;
          const res = await fetch(url);
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || "Failed to load records");

          (data.records || []).forEach((r, i) => {
            const wrap = document.createElement("div");
            wrap.className = "record";

            const info = document.createElement("div");
            info.className = "record-info";

            const idxEl = document.createElement("div");
            idxEl.className = "record-index";
            idxEl.textContent = String(i + 1).padStart(2, "0");
            info.appendChild(idxEl);

            const name = document.createElement("div");
            name.className = "record-name";
            name.textContent = (r.contactName || "").toUpperCase();
            info.appendChild(name);

            const fundLine = document.createElement("div");
            fundLine.className = "record-fund";
            const fundLink = document.createElement("a");
            fundLink.href = r.link || "#";
            fundLink.target = "_blank";
            fundLink.rel = "noopener";
            fundLink.textContent = r.fund || "Fund";
            fundLine.appendChild(fundLink);
            info.appendChild(fundLine);

            const check = document.createElement("div");
            check.className = "kv";
            const checkLabel = document.createElement("p");
            checkLabel.className = "kv-label";
            checkLabel.textContent = "Check Size:";
            const checkVal = document.createElement("p");
            checkVal.className = "kv-value";
            checkVal.textContent = r.checkSize || "";
            check.appendChild(checkLabel);
            check.appendChild(checkVal);
            info.appendChild(check);

            const focus = document.createElement("div");
            focus.className = "kv";
            const focusLabel = document.createElement("p");
            focusLabel.className = "kv-label";
            focusLabel.textContent = "Focus:";
            const focusVal = document.createElement("p");
            focusVal.className = "kv-value";
            focusVal.textContent = r.focus || "";
            focus.appendChild(focusLabel);
            focus.appendChild(focusVal);
            info.appendChild(focus);

            const advice = document.createElement("div");
            advice.className = "kv";
            const adviceLabel = document.createElement("p");
            adviceLabel.className = "kv-label";
            adviceLabel.textContent = "Pitch Advice:";
            const adviceVal = document.createElement("p");
            adviceVal.className = "kv-value";
            adviceVal.textContent = r.pitchAdvice || "";
            advice.appendChild(adviceLabel);
            advice.appendChild(adviceVal);
            info.appendChild(advice);

            wrap.appendChild(info);

            if (r.imageUrl) {
              const imgWrap = document.createElement("div");
              imgWrap.className = "record-image";
              const img = document.createElement("img");
              img.src = r.imageUrl;
              img.alt = r.contactName ? `${r.contactName} image` : "Investor image";
              imgWrap.appendChild(img);
              wrap.appendChild(imgWrap);
            }

            container.appendChild(wrap);
          });
        } catch (e) {
          const error = document.createElement("p");
          error.className = "note";
          error.textContent = "Failed to load records.";
          container.appendChild(error);
        }
      }

      loadRecords();
    </script>
  </body>
</html>
