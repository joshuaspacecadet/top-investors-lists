<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Top 3 Aerospace Seed Investors</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body
    data-base="appNWh4J1hBABWC6J"
    data-table="tblOqtOhWAfA9fWaR"
    data-view="viwsSmHXp0rEeut2R">

    <aside class="left-rail" aria-label="Brand rail">
      <div class="rail-top">
        <img src="https://spacecadet.ventures/wp-content/themes/spacecadet-ventures/asset/icon/star-mark.svg" alt="" />
      </div>
      <div class="rail-body">
        <div class="rail-text"><span class="rail-strong">Spacecadet:</span>  The Marketing VC</div>
      </div>
      <div class="rail-divider" aria-hidden="true"></div>
      <div class="rail-bottom">
        <img src="https://spacecadet.ventures/wp-content/themes/spacecadet-ventures/asset/icon/globe-mark.svg" alt="" />
      </div>
    </aside>

    <header class="site-header" role="banner">
      <div class="site-header__inner">
        <nav class="top-nav" aria-label="Primary">
          <a href="https://spacecadet.ventures/">Home</a>
          <a href="https://spacecadet.ventures/marketing">Marketing</a>
          <a href="https://spacecadet.ventures/mission">Mission</a>
          <a href="https://spacecadet.ventures/crew">Crew</a>
          <a href="https://spacecadet.ventures/portfolio">Portfolio</a>
        </nav>
        <a class="contact-link" href="mailto:greetings@spacecadet.ventures" aria-label="Get in touch">
          <span class="contact-label">Get in touch</span>
          <span class="icon-circle" aria-hidden="true">
            <img src="https://spacecadet.ventures/wp-content/themes/spacecadet-ventures/asset/icon/arrow-forward.svg" width="16" height="16" alt="" />
          </span>
        </a>
      </div>
    </header>

    <main id="main" class="content" role="main">
      <div class="hero">
        <h1 class="hero-headline">Top 3 Aerospace Seed Investors</h1>
        <div class="hero-bottom">
          <div class="hero-content">
            <p class="hero-copy">Identifying appropriate investors is hard. Here's a curated list of Seed investors (in alphabetical order) who actually lead rounds.</p>
          </div>
          <div class="hero-image">
            <img src="Assets/handshake.jpg" alt="Handshake" />
          </div>
        </div>
      </div>
      <div class="divider">
        <img src="Assets/union.svg" alt="" class="divider-star" />
        <div class="divider-line"></div>
      </div>
      <div id="records" class="records"></div>
      <p class="note">Click the button to create a Google Sheet in <em>your</em> Drive from the live Airtable view.</p>
      <button id="copyBtn">Copy to Google Sheets</button>
    </main>

    <script>
      // PUT YOUR CLIENT ID HERE (from Google Cloud Console)
      const GOOGLE_CLIENT_ID = "964428463207-81190lnabk68t0cbcgb5sbab5bss6tp1.apps.googleusercontent.com";

      // OAuth scopes needed to create + write a Sheet in the user's Drive
      const SCOPES = "https://www.googleapis.com/auth/spreadsheets";

      function getAccessToken() {
        return new Promise((resolve, reject) => {
          const client = google.accounts.oauth2.initTokenClient({
            client_id: GOOGLE_CLIENT_ID,
            scope: SCOPES,
            callback: resp => {
              if (resp && resp.access_token) resolve(resp.access_token);
              else reject(new Error("No access token"));
            }
          });
          client.requestAccessToken();
        });
      }

      async function createSheet() {
        const accessToken = await getAccessToken();

        const el = document.body.dataset;
        const payload = {
          base:  el.base,
          table: el.table,
          view:  el.view,
          namePrefix: "Top Investors Lists — Aerospace"
        };

        const res = await fetch("/.netlify/functions/new-sheet", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${accessToken}`
          },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.error || "Failed to create Sheet");
        window.open(data.url, "_blank");
      }

      document.getElementById("copyBtn").addEventListener("click", async () => {
        const btn = document.getElementById("copyBtn");
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.textContent = "Creating Sheet…";
        try {
          // run OAuth + fetch as before
          const accessToken = await getAccessToken();
          const el = document.body.dataset;
          const payload = {
            base:  el.base,
            table: el.table,
            view:  el.view,
            namePrefix: "Top Investors Lists — Aerospace"
          };
          const res = await fetch("/.netlify/functions/new-sheet", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${accessToken}`
            },
            body: JSON.stringify(payload)
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || "Failed to create Sheet");
          // navigate current tab to the new Sheet
          window.location.href = data.url;
        } catch (e) {
          alert("Copy failed: " + (e.message || e));
          btn.disabled = false;
          btn.textContent = originalText;
        }
      });

      async function loadRecords() {
        const container = document.getElementById("records");
        const { base, table, view } = document.body.dataset;
        try {
          const url = `/.netlify/functions/list-records?base=${encodeURIComponent(base)}&table=${encodeURIComponent(table)}&view=${encodeURIComponent(view)}`;
          const res = await fetch(url);
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || "Failed to load records");

          const toc = document.getElementById("toc");
          (data.records || []).forEach((r, i) => {
            const wrap = document.createElement("div");
            wrap.className = "record";
            wrap.id = `rec-${i+1}`;

            const info = document.createElement("div");
            info.className = "record-info";

            const idxEl = document.createElement("div");
            idxEl.className = "record-index";
            idxEl.textContent = String(i + 1).padStart(2, "0");
            info.appendChild(idxEl);

            const name = document.createElement("div");
            name.className = "record-name";
            name.textContent = (r.contactName || "").toUpperCase();
            info.appendChild(name);

            const fundLine = document.createElement("div");
            fundLine.className = "record-fund";
            const fundLink = document.createElement("a");
            fundLink.href = r.link || "#";
            fundLink.target = "_blank";
            fundLink.rel = "noopener";
            fundLink.textContent = r.fund || "Fund";
            fundLine.appendChild(fundLink);
            info.appendChild(fundLine);

            const check = document.createElement("div");
            check.className = "kv";
            const checkLabel = document.createElement("p");
            checkLabel.className = "kv-label";
            checkLabel.textContent = "Check Size:";
            const checkVal = document.createElement("p");
            checkVal.className = "kv-value";
            checkVal.textContent = r.checkSize || "";
            check.appendChild(checkLabel);
            check.appendChild(checkVal);
            info.appendChild(check);

            const focus = document.createElement("div");
            focus.className = "kv";
            const focusLabel = document.createElement("p");
            focusLabel.className = "kv-label";
            focusLabel.textContent = "Focus:";
            const focusVal = document.createElement("p");
            focusVal.className = "kv-value";
            focusVal.textContent = r.focus || "";
            focus.appendChild(focusLabel);
            focus.appendChild(focusVal);
            info.appendChild(focus);

            const advice = document.createElement("div");
            advice.className = "kv";
            const adviceLabel = document.createElement("p");
            adviceLabel.className = "kv-label";
            adviceLabel.textContent = "Pitch Advice:";
            const adviceVal = document.createElement("p");
            adviceVal.className = "kv-value";
            adviceVal.textContent = r.pitchAdvice || "";
            advice.appendChild(adviceLabel);
            advice.appendChild(adviceVal);
            info.appendChild(advice);

            wrap.appendChild(info);

            if (r.imageUrl) {
              const imgWrap = document.createElement("div");
              imgWrap.className = "record-image";
              const img = document.createElement("img");
              img.src = r.imageUrl;
              img.alt = r.contactName ? `${r.contactName} image` : "Investor image";
              imgWrap.appendChild(img);
              wrap.appendChild(imgWrap);
            }

            container.appendChild(wrap);

            // TOC entry
            if (toc) {
              const li = document.createElement("li");
              const a = document.createElement("a");
              a.href = `#rec-${i+1}`;
              a.textContent = r.contactName || r.fund || `Investor ${i+1}`;
              li.appendChild(a);
              toc.appendChild(li);
            }
          });
        } catch (e) {
          const error = document.createElement("p");
          error.className = "note";
          error.textContent = "Failed to load records.";
          container.appendChild(error);
        }
      }

      loadRecords();

      // Auto-resize headline to fit on one line
      function resizeHeadline() {
        const headline = document.querySelector('.hero-headline');
        if (!headline) return;
        
        // Use requestAnimationFrame to ensure layout is complete
        requestAnimationFrame(() => {
          // Measure against the headline's own content box to avoid underestimation
          const paddingLeft = parseInt(window.getComputedStyle(headline).paddingLeft);
          const paddingRight = parseInt(window.getComputedStyle(headline).paddingRight);
          
          const minFontSizeRem = 2; // 2rem minimum
          const maxFontSizeRem = 5; // 5rem maximum
          const step = 0.05; // Increment by 0.05rem for smoother resizing
          
          // Start at max size (5rem) to test
          headline.style.fontSize = maxFontSizeRem + 'rem';
          
          // Force a reflow to get accurate measurements
          headline.offsetHeight;
          
          let fontSizeRem = maxFontSizeRem;
          let contentWidth = headline.clientWidth; // excludes padding
          const availableWidth = contentWidth;     // available line width for the text
          
          // Only resize if it doesn't fit at max size
          if (headline.scrollWidth > availableWidth) {
            // Reduce font size incrementally until it fits
            while (fontSizeRem > minFontSizeRem && headline.scrollWidth > availableWidth) {
              fontSizeRem -= step;
              headline.style.fontSize = fontSizeRem + 'rem';
              // Force reflow for accurate measurement
              headline.offsetHeight;
              contentWidth = headline.clientWidth;
            }
            
            // Ensure it doesn't go below minimum
            if (fontSizeRem < minFontSizeRem) {
              headline.style.fontSize = minFontSizeRem + 'rem';
            }
          }
        });
      }

      // Resize after fonts load and page is ready
      function initResize() {
        if (document.fonts && document.fonts.ready) {
          document.fonts.ready.then(() => {
            requestAnimationFrame(() => {
              setTimeout(resizeHeadline, 200);
            });
          });
        } else {
          requestAnimationFrame(() => {
            setTimeout(resizeHeadline, 500);
          });
        }
      }

      if (document.readyState === 'loading') {
        window.addEventListener('DOMContentLoaded', initResize);
      } else {
        initResize();
      }
      
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          requestAnimationFrame(resizeHeadline);
        }, 100);
      });
    </script>
  </body>
</html>
